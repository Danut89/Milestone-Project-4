{% extends "base.html" %}
{% block title %}My Orders{% endblock %}

{% block content %}
<section class="container py-5 shop-header">
  <h1 class="mb-4">ðŸ“¦ My Orders</h1>

  {% if orders %}
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle text-center">
        <thead class="table-light">
          <tr>
            <th>Order #</th>
            <th>Date</th>
            <th>Total</th>
            <th>Preview</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          {% for order in orders %}
            <tr class="{% if order.id == most_recent_id %}table-success fw-bold{% endif %}">
              <td>{{ order.id }}</td>
              <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
              <td>Â£{{ order.total_price }}</td>
              <td>
                {% with preview=order.items.first %}
                  {% if preview and preview.product %}
                    {{ preview.product.name }}
                  {% else %}
                    N/A
                  {% endif %}
                {% endwith %}
              </td>
              <td>
                <a href="{% url 'order_detail' order.id %}" class="btn btn-outline-primary btn-sm">View</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <nav aria-label="Order pagination" class="mt-4">
      <ul class="pagination justify-content-center">
        {% if orders.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ orders.previous_page_number }}">Â« Prev</a>
          </li>
        {% endif %}

        {% for num in orders.paginator.page_range %}
          {% if orders.number == num %}
            <li class="page-item active">
              <span class="page-link">{{ num }}</span>
            </li>
          {% elif num > orders.number|add:"-3" and num < orders.number|add:"3" %}
            <li class="page-item">
              <a class="page-link" href="?page={{ num }}">{{ num }}</a>
            </li>
          {% endif %}
        {% endfor %}

        {% if orders.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ orders.next_page_number }}">Next Â»</a>
          </li>
        {% endif %}
      </ul>
    </nav>

  {% else %}
    <p>You haven't placed any orders yet.</p>
  {% endif %}
</section>
{% endblock %}
